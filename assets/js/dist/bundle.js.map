{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./fileio/load.js","webpack:///./node_modules/csv/csv.js","webpack:///./fileio/save.js","webpack:///./docs/assets/js/src/main.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","load","options","readMethod","Promise","resolve","reject","fileLoaded","e","reader","target","readyState","result","loadSelectedFile","file","FileReader","addEventListener","abort","DOMException","readAsArrayBuffer","readAsBinaryString","readAsDataURL","readAsText","RangeError","readFile","$fileInput","document","createElement","type","files","click","stringify","parse","csv","data","transpose","sanitise","rows","_shape","_escape","_join","maxLength","reduce","row","Math","max","length","iMax","jMax","j","iRow","iCol","cellValue","push","match","replace","join","csvString","_tokenise","_validate","mapper","map","tokens","inQuote","wasQuote","tokenStart","char","comma","quote","newline","eof","Error","token","substring","rowLength","$link","save","File","_saveFile","Blob","_saveBlob","_saveData","blob","TypeError","filename","navigator","msSaveBlob","url","URL","createObjectURL","_downloadDataUrl","this","JSON","console","error","_extendFilename","String","dataUrl","href","download","revokeObjectURL","extension","RegExp","test","loadImage","fileUrl","querySelectorAll","forEach","$image","src","$el","then","saveData","saveJson","text","foo","saveCsv","saveFile","async"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const module = {\r\n\tload: (options) => {\r\n\t\toptions = options || {};\r\n\t\toptions.readMethod = options.readMethod || 'text';\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst fileLoaded = (e) => {\r\n\t\t\t\tlet reader = e.target;\r\n\r\n\t\t\t\tif (reader.readyState === 2) {\r\n\t\t\t\t\t// DONE\r\n\t\t\t\t\tresolve(reader.result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst readFile = (file) => {\r\n\t\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\t\treader.addEventListener('load', fileLoaded);\r\n\t\t\t\treader.addEventListener('error', () => {\r\n\t\t\t\t\treader.abort();\r\n\t\t\t\t\treject(new DOMException('Error parsing file'));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tswitch (options.readMethod) {\r\n\t\t\t\t\tcase 'arrayBuffer':\r\n\t\t\t\t\t\treader.readAsArrayBuffer(file);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'binaryString':\r\n\t\t\t\t\t\treader.readAsBinaryString(file);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'dataUrl':\r\n\t\t\t\t\t\treader.readAsDataURL(file);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\treader.readAsText(file);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new RangeError(`FileIO: Unrecognised readMethod ${options.readMethod}`);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst loadSelectedFile = (file) => {\r\n\t\t\t\tif (options.readMethod === 'file') {\r\n\t\t\t\t\tresolve(file);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treadFile(file);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst loadSelectedFileEvent = (e) => {\r\n\t\t\t\tlet $fileInput = e.target;\r\n\t\t\t\tlet file = $fileInput.files[0];\r\n\r\n\t\t\t\tif (file) {\r\n\t\t\t\t\tloadSelectedFile(file);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst $fileInput = document.createElement('input');\r\n\t\t\t$fileInput.type = 'file';\r\n\t\t\t$fileInput.addEventListener('change', loadSelectedFileEvent);\r\n\r\n\t\t\t$fileInput.click();\r\n\t\t});\r\n\t},\r\n};\r\n\r\nexport const { load } = module;\r\n","const { stringify, parse } = (() => {\n\tconst csv = {\n\t\tstringify: function (data, options) {\n\t\t\toptions = options || {};\n\t\t\toptions.transpose = options.transpose || false;\n\t\t\toptions.sanitise = options.sanitise || false;\n\n\t\t\t// Enforce square data and apply CSV escaping, then convert to string\n\t\t\tlet rows = data;\n\n\t\t\trows = csv._shape(data, options);\n\t\t\trows = csv._escape(rows, options);\n\n\t\t\trows = csv._join(rows);\n\n\t\t\treturn rows;\n\t\t},\n\n\t\t_shape: function (data, options) {\n\t\t\t// Pad missing cells with empty strings and,\n\t\t\t// if necessary, transpose the data\n\n\t\t\tconst transpose = options.transpose;\n\n\t\t\tconst maxLength = data.reduce((maxLength, row) => Math.max(maxLength, row.length), 0);\n\n\t\t\t// Flip rows and columns if transposing data\n\t\t\tconst iMax = transpose ? maxLength : data.length;\n\t\t\tconst jMax = transpose ? data.length : maxLength;\n\n\t\t\tlet rows = [];\n\t\t\tfor (let i = 0; i < iMax; i++) {\n\t\t\t\tlet row = [];\n\t\t\t\tfor (let j = 0; j < jMax; j++) {\n\t\t\t\t\tlet iRow = transpose ? j : i;\n\t\t\t\t\tlet iCol = transpose ? i : j;\n\n\t\t\t\t\tlet cellValue = data[iRow][iCol];\n\n\t\t\t\t\tif (iCol >= data[iRow].length) {\n\t\t\t\t\t\tcellValue = '';\n\t\t\t\t\t}\n\n\t\t\t\t\trow.push(cellValue);\n\t\t\t\t}\n\t\t\t\trows.push(row);\n\t\t\t}\n\n\t\t\treturn rows;\n\t\t},\n\n\t\t_escape: function (rows, options) {\n\t\t\t// Make sure any cells containing \" or , or a newline are escaped appropriately\n\n\t\t\tconst sanitise = options.sanitise;\n\n\t\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\t\tlet row = rows[i];\n\n\t\t\t\tfor (let j = 0; j < row.length; j++) {\n\t\t\t\t\tif (typeof row[j] === 'undefined') {\n\t\t\t\t\t\t// Replace undefined with ''\n\t\t\t\t\t\trow[j] = '';\n\t\t\t\t\t} else if (typeof row[j] !== 'string') {\n\t\t\t\t\t\t// Convert to string\n\t\t\t\t\t\trow[j] = '' + row[j];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sanitise) {\n\t\t\t\t\t\t// Prevent spreadsheet software like\n\t\t\t\t\t\t// Excel from trying to execute code\n\t\t\t\t\t\tif (row[j].match(/^[=\\-+@]/)) {\n\t\t\t\t\t\t\trow[j] = '\\t' + row[j];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (row[j].match(/,|\"|\\n/)) {\n\n\t\t\t\t\t\t// Turn any double quotes into escaped double quotes\n\t\t\t\t\t\trow[j] = row[j].replace(/\"/g, '\"\"');\n\n\t\t\t\t\t\t// Wrap cell in double quotes\n\t\t\t\t\t\trow[j] = '\"' + row[j] + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rows;\n\t\t},\n\n\t\t_join: function (rows) {\n\t\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\t\trows[i] = rows[i].join(',');\n\t\t\t}\n\t\t\trows = rows.join('\\n');\n\n\t\t\treturn rows;\n\t\t},\n\n\n\t\tparse: function (csvString, options) {\n\t\t\tlet rows = csv._tokenise(csvString);\n\n\t\t\tcsv._validate(rows);\n\n\t\t\tif (options && options.mapper) {\n\t\t\t\trows = rows.map((row) => row.map(options.mapper));\n\t\t\t}\n\n\t\t\treturn rows;\n\t\t},\n\n\t\t_tokenise: function (csvString) {\n\t\t\t// Walk through each character and produce an array of tokens\n\n\t\t\tlet tokens = [];\n\n\t\t\t// Remove carriage returns\n\t\t\tcsvString = csvString.replace(/\\r/g, '');\n\n\t\t\tlet inQuote = false;\n\t\t\tlet wasQuote = false;\n\n\t\t\tlet tokenStart = 0;\n\t\t\tlet row = [];\n\t\t\tfor (let i = 0; i < csvString.length; i++) {\n\t\t\t\tlet char = csvString[i];\n\n\t\t\t\tlet comma = char === ',';\n\t\t\t\tlet quote = char === '\"';\n\t\t\t\tlet newline = char === '\\n';\n\t\t\t\tlet eof = i === csvString.length -1; // eof - End Of File\n\n\t\t\t\tif (inQuote) {\n\t\t\t\t\t// Characters may be delimited\n\t\t\t\t\tif (quote) {\n\t\t\t\t\t\t// Check if the next character is another double quote, i.e. if it is escaped\n\t\t\t\t\t\tlet nextChar = csvString[i+1];\n\n\t\t\t\t\t\tif (nextChar === '\"') {\n\t\t\t\t\t\t\t// This and the next character combined make an escaped double quote,\n\t\t\t\t\t\t\t// so the quote has not ended and we should skip over the next character\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// The quote has ended\n\t\t\t\t\t\t\tinQuote = false;\n\t\t\t\t\t\t\twasQuote = true;\n\n\t\t\t\t\t\t\tif (!eof) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (eof) {\n\t\t\t\t\t\tthrow new Error(`CSV parse: Reached end of file before ending quote. At index ${i}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!inQuote && (comma || newline || eof)) {\n\t\t\t\t\t// These are the characters that denote the end of a token\n\t\t\t\t\tlet token = csvString.substring(tokenStart, i+1);\n\n\t\t\t\t\tif (comma || newline) {\n\t\t\t\t\t\t// Don't keep the separator\n\t\t\t\t\t\ttoken = token.substring(0, token.length - 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (wasQuote) {\n\t\t\t\t\t\twasQuote = false;\n\n\t\t\t\t\t\t// Remove start and end quotes\n\t\t\t\t\t\ttoken = token.substring(1, token.length - 1);\n\n\t\t\t\t\t\t// Replace escaped quotes\n\t\t\t\t\t\ttoken = token.replace(/\"\"/g, '\"');\n\t\t\t\t\t}\n\t\t\t\t\trow.push(token);\n\n\t\t\t\t\tif (comma && eof) {\n\t\t\t\t\t\t// It's the end of the last token, and the last cell is empty\n\t\t\t\t\t\trow.push('');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newline || eof) {\n\t\t\t\t\t\ttokens.push(row);\n\t\t\t\t\t\tif (newline) {\n\t\t\t\t\t\t\trow = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttokenStart = i+1;\n\t\t\t\t} else if (wasQuote) {\n\t\t\t\t\tthrow new Error(`CSV parse: A value must be complete immediately after closing a quote. At index ${i}`);\n\t\t\t\t} else if (quote) {\n\t\t\t\t\tinQuote = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn tokens;\n\t\t},\n\n\t\t_validate: function (rows) {\n\t\t\t// Each row of a CSV should have the same length;\n\n\t\t\tif (rows && rows.length > 1) {\n\t\t\t\tlet rowLength = rows[0].length;\n\t\t\t\tfor (let i = 1; i < rows.length; i++) {\n\t\t\t\t\tlet row = rows[i];\n\n\t\t\t\t\tif (row.length !== rowLength) {\n\t\t\t\t\t\tthrow new Error(`CSV parse: Row ${i} does not have the same length as the first row (${rowLength})`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\treturn {\n\t\tstringify: csv.stringify,\n\t\tparse: csv.parse,\n\t};\n})();\n\nexport { stringify, parse };\n","import * as csv from 'csv';\r\n\r\nlet $link;\r\n\r\nconst module = {\r\n\tsave: (data, options) => {\r\n\t\toptions = options || {};\r\n\r\n\t\tif (data instanceof File) {\r\n\t\t\tmodule._saveFile(data, options);\r\n\t\t} else if (data instanceof Blob) {\r\n\t\t\tmodule._saveBlob(data, options);\r\n\t\t} else {\r\n\t\t\tmodule._saveData(data, options);\r\n\t\t}\r\n\t},\r\n\r\n\t_saveBlob: (blob, options) => {\r\n\t\tif (!(blob instanceof Blob)) {\r\n\t\t\tthrow new TypeError('FileIO: save blob requires a Blob');\r\n\t\t}\r\n\r\n\t\toptions.filename = options.filename || 'file';\r\n\r\n\t\tif (navigator.msSaveBlob) {\r\n\t\t\tnavigator.msSaveBlob(blob, filename);\r\n\t\t} else {\r\n\t\t\tlet url = URL.createObjectURL(blob);\r\n\t\t\tmodule._downloadDataUrl(url, options.filename);\r\n\t\t}\r\n\t},\r\n\r\n\t_saveFile: (file, options) => {\r\n\t\tif (!(file instanceof File)) {\r\n\t\t\tthrow new TypeError('FileIO: save file requires a File');\r\n\t\t}\r\n\r\n\t\toptions.filename = options.filename || file.name || 'file';\r\n\r\n\t\tif (navigator.msSaveBlob) {\r\n\t\t\tnavigator.msSaveBlob(file, options.filename);\r\n\t\t} else {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.readAsDataURL(file);\r\n\t\t\treader.addEventListener('load', function () {\r\n\t\t\t\tmodule._downloadDataUrl(this.result, options.filename);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_saveData: function (data, options) {\r\n\t\toptions.filename = options.filename || 'file';\r\n\t\toptions.type = options.type || 'text/plain'\r\n\r\n\t\t// CSV only\r\n\t\toptions.transpose = options.transpose || false;\r\n\t\toptions.sanitise = options.sanitise || false;\r\n\r\n\t\t// Type shorthands\r\n\t\tswitch (options.type) {\r\n\t\t\tcase 'json':\r\n\t\t\t\toptions.type = 'application/json';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'csv':\r\n\t\t\t\toptions.type = 'text/csv';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (options.type === 'application/json') {\r\n\t\t\ttry {\r\n\t\t\t\tdata = JSON.stringify(data);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('FileIO: Failed to save JSON');\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\r\n\t\t\toptions.filename = module._extendFilename(options.filename, 'json');\r\n\t\t} else if (options.type === 'text/csv') {\r\n\t\t\tif (!(typeof data === 'string' || data instanceof String)) {\r\n\t\t\t\tdata = csv.stringify(data, options);\r\n\t\t\t}\r\n\t\t\toptions.filename = module._extendFilename(options.filename, 'csv');\r\n\t\t}\r\n\r\n\t\t// Construct a Blob and download it\r\n\t\tlet blob = new Blob(\r\n\t\t\t[data],\r\n\t\t\t{ type: options.type }\r\n\t\t);\r\n\r\n\t\tmodule._saveBlob(blob, options);\r\n\t},\r\n\r\n\t_downloadDataUrl: function (dataUrl, filename) {\r\n\t\t$link = $link || document.createElement('a');\r\n\t\t$link.href = dataUrl;\r\n\t\t$link.download = filename;\r\n\t\t$link.click();\r\n\r\n\t\tURL.revokeObjectURL(dataUrl);\r\n\t},\r\n\r\n\t_extendFilename: function (filename, extension) {\r\n\t\tlet testPattern = new RegExp('\\\\.' + extension + '$');\r\n\r\n\t\tif (!testPattern.test(filename)) {\r\n\t\t\tfilename += '.' + extension;\r\n\t\t}\r\n\r\n\t\treturn filename;\r\n\t},\r\n};\r\n\r\nexport const { save } = module;\r\n","import * as fileIO from '/fileio';\n\nconst loadImage = (fileUrl) => {\n\tlet $image = document.querySelectorAll('.js-fileio-image');\n\t$image.forEach(($image) => $image.src = fileUrl);\n};\ndocument.querySelectorAll('.js-load-image').forEach(($el) => $el.addEventListener('click', () => {\n\tfileIO.load({ readMethod: 'dataUrl' }).then(loadImage);\n}));\n\nconst saveData = () => {\n\tlet data = 'Hey look, the file has some content!';\n\tlet filename = 'test file.txt';\n\tlet type = 'text/plain';\n\n\tfileIO.save(data, { filename, type });\n};\ndocument.querySelectorAll('.js-save-data').forEach(($el) => $el.addEventListener('click', saveData));\n\nconst saveJson = () => {\n\tlet data = {\n\t\ttext: 1,\n\t\tfoo: 'bar'\n\t};\n\tlet filename = 'test json';\n\n\tfileIO.save(data, { filename, type: 'json' });\n};\ndocument.querySelectorAll('.js-save-json').forEach(($el) => $el.addEventListener('click', saveJson));\n\nconst saveCsv = () => {\n\tlet data = [\n\t\t['even numbers', 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24],\n\t\t['odd numbers', 1, 3, 5, 7, 9],\n\t\t['prime numbers, up to ten', 2, 3, 5, 7]\n\t];\n\tlet filename = 'test csv';\n\n\tfileIO.save(data, {filename, type: 'csv', transpose: true });\n};\ndocument.querySelectorAll('.js-save-csv').forEach(($el) => $el.addEventListener('click', saveCsv));\n\nconst saveFile = async () => {\n\tconst file = await fileIO.load({ readMethod: 'file' });\n\tfileIO.save(file);\n};\ndocument.querySelectorAll('.js-save-file').forEach(($el) => $el.addEventListener('click', saveFile));\n"],"sourceRoot":""}