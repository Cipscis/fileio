!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r={load:e=>((e=e||{}).readMethod=e.readMethod||"text",new Promise((t,n)=>{const r=e=>{let n=e.target;2===n.readyState&&t(n.result)},a=a=>{"file"===e.readMethod?t(a):(t=>{let a=new FileReader;switch(a.addEventListener("load",r),a.addEventListener("error",()=>{a.abort(),n(new DOMException("Error parsing file"))}),e.readMethod){case"arrayBuffer":a.readAsArrayBuffer(t);break;case"binaryString":a.readAsBinaryString(t);break;case"dataUrl":a.readAsDataURL(t);break;case"text":a.readAsText(t);break;default:throw new RangeError("FileIO: Unrecognised readMethod "+e.readMethod)}})(a)},o=document.createElement("input");o.type="file",o.addEventListener("change",e=>{let t=e.target.files[0];t&&a(t)}),o.click()}))},{load:a}=r,{stringify:o,parse:i}=(()=>{const e={stringify:function(t,n){(n=n||{}).transpose=n.transpose||!1,n.sanitise=n.sanitise||!1;let r=t;return r=e._shape(t,n),r=e._escape(r,n),r=e._join(r),r},_shape:function(e,t){const n=t.transpose,r=e.reduce((e,t)=>Math.max(e,t.length),0),a=n?r:e.length,o=n?e.length:r;let i=[];for(let t=0;t<a;t++){let r=[];for(let a=0;a<o;a++){let o=n?a:t,i=n?t:a,l=e[o][i];i>=e[o].length&&(l=""),r.push(l)}i.push(r)}return i},_escape:function(e,t){const n=t.sanitise;for(let t=0;t<e.length;t++){let r=e[t];for(let e=0;e<r.length;e++)void 0===r[e]?r[e]="":"string"!=typeof r[e]&&(r[e]=""+r[e]),n&&r[e].match(/^[=\-+@]/)&&(r[e]="\t"+r[e]),r[e].match(/,|"|\n/)&&(r[e]=r[e].replace(/"/g,'""'),r[e]='"'+r[e]+'"')}return e},_join:function(e){for(let t=0;t<e.length;t++)e[t]=e[t].join(",");return e=e.join("\n")},parse:function(t,n){let r=e._tokenise(t);return e._validate(r),n&&n.mapper&&(r=r.map(e=>e.map(n.mapper))),r},_tokenise:function(e){let t=[];e=e.replace(/\r/g,"");let n=!1,r=!1,a=0,o=[];for(let i=0;i<e.length;i++){let l=e[i],s=","===l,c='"'===l,f="\n"===l,d=i===e.length-1;if(n)if(c){if('"'===e[i+1]){i++;continue}if(n=!1,r=!0,!d)continue}else if(d)throw new Error("CSV parse: Reached end of file before ending quote. At index "+i);if(!n&&(s||f||d)){let n=e.substring(a,i+1);(s||f)&&(n=n.substring(0,n.length-1)),r&&(r=!1,n=n.substring(1,n.length-1),n=n.replace(/""/g,'"')),o.push(n),s&&d&&o.push(""),(f||d)&&(t.push(o),f&&(o=[])),a=i+1}else{if(r)throw new Error("CSV parse: A value must be complete immediately after closing a quote. At index "+i);c&&(n=!0)}}return t},_validate:function(e){if(e&&e.length>1){let t=e[0].length;for(let n=1;n<e.length;n++){if(e[n].length!==t)throw new Error(`CSV parse: Row ${n} does not have the same length as the first row (${t})`)}}}};return{stringify:e.stringify,parse:e.parse}})();let l;const s={save:(e,t)=>{t=t||{},e instanceof File?s._saveFile(e,t):e instanceof Blob?s._saveBlob(e,t):s._saveData(e,t)},_saveBlob:(e,t)=>{if(!(e instanceof Blob))throw new TypeError("FileIO: save blob requires a Blob");if(t.filename=t.filename||"file",navigator.msSaveBlob)navigator.msSaveBlob(e,filename);else{let n=URL.createObjectURL(e);s._downloadDataUrl(n,t.filename)}},_saveFile:(e,t)=>{if(!(e instanceof File))throw new TypeError("FileIO: save file requires a File");if(t.filename=t.filename||e.name||"file",navigator.msSaveBlob)navigator.msSaveBlob(e,t.filename);else{let n=new FileReader;n.readAsDataURL(e),n.addEventListener("load",(function(){s._downloadDataUrl(this.result,t.filename)}))}},_saveData:function(e,t){switch(t.filename=t.filename||"file",t.type=t.type||"text/plain",t.transpose=t.transpose||!1,t.sanitise=t.sanitise||!1,t.type){case"json":t.type="application/json";break;case"csv":t.type="text/csv"}if("application/json"===t.type){try{e=JSON.stringify(e)}catch(e){console.error("FileIO: Failed to save JSON"),console.error(e)}t.filename=s._extendFilename(t.filename,"json")}else"text/csv"===t.type&&("string"==typeof e||e instanceof String||(e=o(e,t)),t.filename=s._extendFilename(t.filename,"csv"));let n=new Blob([e],{type:t.type});s._saveBlob(n,t)},_downloadDataUrl:function(e,t){l=l||document.createElement("a"),l.href=e,l.download=t,l.click(),URL.revokeObjectURL(e)},_extendFilename:function(e,t){return new RegExp("\\."+t+"$").test(e)||(e+="."+t),e}},{save:c}=s,f=e=>{document.querySelectorAll(".js-fileio-image").forEach(t=>t.src=e)};document.querySelectorAll(".js-load-image").forEach(e=>e.addEventListener("click",()=>{a({readMethod:"dataUrl"}).then(f)}));const d=()=>{c("Hey look, the file has some content!",{filename:"test file.txt",type:"text/plain"})};document.querySelectorAll(".js-save-data").forEach(e=>e.addEventListener("click",d));const u=()=>{c({text:1,foo:"bar"},{filename:"test json",type:"json"})};document.querySelectorAll(".js-save-json").forEach(e=>e.addEventListener("click",u));const p=()=>{c([["even numbers",0,2,4,6,8,10,12,14,16,18,20,22,24],["odd numbers",1,3,5,7,9],["prime numbers, up to ten",2,3,5,7]],{filename:"test csv",type:"csv",transpose:!0})};document.querySelectorAll(".js-save-csv").forEach(e=>e.addEventListener("click",p));const m=async()=>{const e=await a({readMethod:"file"});c(e)};document.querySelectorAll(".js-save-file").forEach(e=>e.addEventListener("click",m))}]);
//# sourceMappingURL=bundle.js.map